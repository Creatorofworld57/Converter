<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #header-value {
            font-size: 1.5em;
            color: black;
            align-self: flex-start;
            margin-top: 10px;
        }

        audio {
            margin-bottom: 10px;
            position: absolute;
            top: 70px;
            left: 10px;
        }
        .button {
            position: absolute;
            top: 140px;
            left: 170px;
            background-color: #000;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }
        .button1 {
            position: absolute;
            top: 140px;
            left: 20px;
            background-color: #000;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }
        .top-left-button{
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #000;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }
        button:hover,.button1:hover,.top-left-button:hover {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
        }
    </style>
    <meta charset="UTF-8">
    <title>Audio Player</title>
</head>
<body>

<audio controls id="myAudio">
</audio>

<div>
    <button type="button" class="button" id="first" onclick="nextAudio()">Следующий</button>
    <button type="button" class="button1" id="second" onclick="prevAudio()">Предыдущий</button>
    <button class="top-left-button" onclick=redirectTo("http://localhost:8080/api/Welcome")>Назад</button>
</div>

<div class="form-container">
    <div id="header-value">Loading header...</div>
</div>

<script>
    let counter = 152;

    document.addEventListener('DOMContentLoaded', () => {
        loadAudio(counter);
    });

    async function nextAudio() {
        counter += 50;
        await loadAudio(counter);
    }

    async function prevAudio() {
        if (counter !== 152) {
            counter -= 50;
            await loadAudio(counter);
        }
    }

    async function loadAudio(counter) {
        const audioUrl = `http://localhost:8080/api/audio/${counter}`;
        const audioType = 'audio/mp3';

        // Получаем элемент аудио по его id
        const audioElement = document.getElementById('myAudio');

        // Удаляем все текущие source элементы
        while (audioElement.firstChild) {
            audioElement.removeChild(audioElement.firstChild);
        }

        // Создаем новый элемент source
        const sourceElement = document.createElement('source');
        sourceElement.src = audioUrl;
        sourceElement.type = audioType;

        // Добавляем новый source элемент в элемент аудио
        audioElement.appendChild(sourceElement);

        // Устанавливаем название трека (если есть)
        const name = document.getElementById('header-value');
        try {
            const response = await fetch(`http://localhost:8080/api/audioName/${counter.toString()}`, { method: 'GET' });

            name.textContent = await response.text();
        } catch (error) {
            console.error('Error fetching audio name:', error);
            name.textContent = 'Error loading header';
        }

        // Перезагружаем аудио для его воспроизведения с новым источником
        try {
            audioElement.load();
            audioElement.play();
            audioElement.volume = 0.3;
        } catch (error) {
            console.error('Error playing audio:', error);
        }
    }

    // Добавляем обработчик события 'ended'
    const audioElement = document.getElementById('myAudio');
    audioElement.addEventListener('ended', nextAudio);
    function redirectTo(str) {
        // Открываем новое окно

        let newWindow = window.open(str);

        // Проверяем, удалось ли открыть новое окно
        if (newWindow) {
            // Закрываем текущее окно
            window.close();
        } else {
            alert('Unable to close the current window.');
        }
    }
</script>

</body>
</html>
